# Fast R-CNN

- Fast R-CNN 핵심 아이디어

Fast R-CNN은 SPPNet이 가지는 한계점들을 극복하고자 하는 시도에서 출발한다.

SPPNet은 기존 R-CNN이 Selective Search로 찾아낸 모든 RoI에 대해서 CNN inference를 하는 문제를 CNN inference를 전체 이미지에 대하여 1회만 수행하고, 이 feature map을 공유하는 방식으로 해결했다.

그러나 여전히 모델을 학습시키기 위해서는 여러 단계를 거쳐야했고, FC Layer밖에 학습시키지 못하는 한계점이 있었다. 

따라서 **CNN 특징 추출부터 classification, bounding box regression 까지 모두 하나의 모델에서 학습시키자!"** 가 Fast R-CNN의 핵심 주장이다.

- 전체 알고리즘

![image](https://user-images.githubusercontent.com/66320010/104447708-83121380-55df-11eb-8ef1-247b8bf9c921.png)

1. 먼저 전체 이미지를 미리 학습된 CNN을 통과시켜 feature map을 추출한다.

2. Selective Search를 통해서 찾은 각각의 RoI에 대하여 RoI Pooling을 진행한다. 그 결과로 고정된 크기의 feature vector를 얻는다.

3. feature vector는 fully connected layer들을 통과한 뒤, 두 개의 브랜치로 나뉘게 된다

하나의 브랜치는 softmax를 통과하여 해당 RoI가 어떤 물체인지 classification한다. 이제 SVM은 사용되지 않는다.

다른 하나의 브랜치는 bounding box regression을 통해 selective search로 찾은 박스의 위치를 조정한다.

CNN을 통과시킨 뒤, 그 feature map을 공유하는 것은 이미 SPPNet에서 제안된 방법이다. 그 이후의 스텝들은 SPPNet이나 R-CNN과 그다지 다르지 않다. **본 논문의 가장 큰 특징은 이들을 스텝별로 쪼개어 학습을 진행하지 않고, end-to-end로 엮었다는데 있으며 그 결과로 학습 속도, 인퍼런스 속도, 정확도 모두를 향상시켰다는데 의의가 있다.**

# 1. CNN(Convolutional Neural Network)

![image](https://user-images.githubusercontent.com/66320010/104448580-b4d7aa00-55e0-11eb-8e26-c92ed5a89fe2.png)

이전 R-CNN에서는 Selective Search로 뽑아낸 Region Proposal 후보들(2000개)을 모두 CNN 모델에 집어 넣어 굉장히 시간이 많이 걸렸다. 

하지만 Fast R-CNN은 R-CNN과 다르게 뽑아낸 영역을 Crop하지 않고 그대로 가지고 있고, 전체 이미지를 CNN Model에 집어 넣은 후 CNN으로부터 나온 Feature Map에 RoI Projection을 하는 방식을 택했다.(SPPnet에서 보완한 R-CNN의 단점과 동일하다)

**즉, input image 1장으로부터 CNN Model에 들어가는 이미지는 2000장 -> 1장이 된 것이다.**

# 2. RoI (Region of Interest) Pooling

![image](https://user-images.githubusercontent.com/66320010/104449026-5101b100-55e1-11eb-87cc-0a3db1df3302.png)

위 그림처럼 Projection시킨 RoI를 FCs(Fully Connected Layer)에 넣기 위해서는 같은 Resolution의 Feature map이 필요하다. 

하지만 Selective Search를 통해 구해졌던 RoI 영역은 각각 다른 크기를 가지고 있다. 따라서 이 Resolution의 크기를 맞춰주기 위해 **RoI Pooling**을 수행한다.
